<html lang="en">
    <head>
        <div class="jumbotron text-center">
            <h1> DE Laundro Dashboard</h1>
        </div>

        <!-- Navigation Bar  -->
        <nav>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">

                <li class="nav-item active">
                    <a class="nav-link" href="vendor.html">Dashboard <span class="sr-only"></span></a>
                </li>

                <li class="nav-item active">
                    <a class="nav-link" href="monitoring.html">Monitoring <span class="sr-only"></span></a>
                </li>

                </ul>
            </div>
        </nav>

        <title>Monitoring</title>
        <!-- Bootstrap 4 -->
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

        <!-- API KEY -->
        <meta name="google-signin-client_id" content="369460233382-4oa59s8nmq9cu2cu0q5kb6cka5og1rng.apps.googleusercontent.com">
        
        <script src="https://apis.google.com/js/platform.js" async defer></script>

        <!-- Import JS -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
        <script>
            // Retrieving all the information stored in the session
            window.sessionStorage;
            var full_name = sessionStorage.getItem("full_name"); 

            // Validation in case no sign in 
            if(full_name==null){
                window.location.replace("index.html");
            }
                        
        </script>

</head>
<body>
    <div class="container">
        <h1 class="display-4">Monitoring</h1>
        <table id="monitoring_table" class='table table-striped' border='1'>
        <thead class='thead-dark'>
            <tr>
                <th>Index </th>
                <th>Machine ID</th>
                <th>location</th>
                <th>monitoring Code ID</th>
                <th>Errcodeid</th>
                <th>Payment</th>
                <th>Date & Time</th>
            </tr>
        </thead>
    </table>
    </div>

    <script>
        function showError(message) {
            // Hide the table and button in the event of error
            $('#monitoring_table').hide();

            // Display an error under the main container
            $('#main-container')
                .append("<label>"+message+"</label>");

    }

        // Copy pasta to retrieve information
        // anonymous async function 
        // - using await requires the function that calls it to be async
        $(async() => {           
            // Change serviceURL to your own
            var serviceURL = "http://127.0.0.1:8003/monitoring";
            try {
                    const response =
                    await fetch(
                    serviceURL, { method: 'GET' }
                    );
                    const data = await response.json();
                    var monitoring = data.monitoring; //the arr is in data.monitoring of the JSON data
        
                    // array or array.length are false
                    if (!monitoring || !monitoring.length) {
                        showError('Monitoring list empty or undefined.')
                    } else {
                        // for loop to setup all table rows with obtained monitoring data
                        var rows = "";
                        for (const monitor_row of monitoring) {
                            
                            eachRow =
                                "<td>" + monitor_row.curuser + "</td>" +
                                "<td>" + monitor_row.errcodeid + "</td>" +
                                "<td>" + monitor_row.location + "</td>" +
                                "<td>" + monitor_row.machineid + "</td>"+
                                "<td>" + monitor_row.prevuser + "</td>" +
                                "<td>" + monitor_row.startcode + "</td>" +
                                "<td>" + monitor_row.monitoringcodeid + "</td>" +
                                "<td>" + monitor_row.unlockcode + "</td>";
                                
                            rows += "<tbody><tr>" + eachRow + "</tr></tbody>";
                        }
                        // add all the rows to the table
                        $('#monitoring_table').append(rows);
    </script>

</body>
</html>